<h3> Server Administration Page </h3>
<table id="data" class="table table-striped table-bordered" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Server Name</th>
            <th>Server IP </th>
            <th>Menu</th>
        </tr>
    </thead>
    <tbody id="tableContent">
    </tbody>
</table>

<a href="javascript: void(0)" class="btn btn-primary" data-toggle="modal" data-target="#addServer">Add New Server</a>

<script type="application/javascript">
    var getJSON = function (apiurl, action, payload, callback) {
        $.ajax({
            type: action
            , url: apiurl
            , data: payload
            , contentType: "application/json"
            , dataType: "json"
            , cache: false
            , success: callback
        });
    }

    

    var growl = function (gtitle, gtext) {
        new PNotify({
            title: gtitle
            , text: gtext
        });
    };


    var appendTableData = function (serverName, serverIp, id) {
        var line = "<tr><td>" + serverName + "</td><td>" + serverIp + "</td>" +
            '<td>  <a href="javascript: void(0)" class="btn btn-primary">Ansible Provision</a>' +
            '<a href="javascript: void(0)" class="btn btn-primary"> Code Deploy</a>' +
            '<a href="javascript: void(0)" onclick="deleteNode('+"'" + id +"'"+')" class="btn btn-danger">'+
            '<i class="fa fa-trash" aria-hidden="true"></i>Delete</a></td></tr>';
        $("#tableContent").append(line);
    }

    function restTableData() {
        $("#tableContent").empty();
         getJSON("/api/nodes", "GET", null, function (data) {
        for (var i = 0; i < data.length; i++) {
            appendTableData(data[i].serverIp, data[i].serverName, data[i].id);
        }
    });

    }
    
    getJSON("/api/nodes", "GET", null, function (data) {
        for (var i = 0; i < data.length; i++) {
            appendTableData(data[i].serverIp, data[i].serverName, data[i].id);
        }
    });

    var makeModel = (function (formFields, id, title) {
        html = '<!-- Modal -->' +
            '<div class="modal fade" id="' + id + '" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">' +
            '<div class="modal-dialog">' +
            '<div class="modal-content">' +
            '<div class="modal-header">' +
            '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>' +
            '<h4 class="modal-title" id="myModalLabel">' + title + '</h4>' +
            '</div>' +
            '<div class="modal-body">' +
            formFields +
            '</div>' +
            '<div class="modal-footer">' + //	buttons+
            '<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>' +
            '<button type="button" onclick="createNewNode()" class="btn btn-primary">Save</button>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>';
        $("body").append(html);
    });

    var createNewNode= function(){
        console.log("adding new server!!");
               var req={ 
            "serverName":  $("#serverName").val().toString(),
            "serverIp": $("#serverIp").val().toString()
            }
               getJSON("/api/nodes", "POST", JSON.stringify(req), function (data) {
                    restTableData(); });
    }

    var deleteNode=function( id ){
          getJSON("/api/nodes/"+id, "DELETE", null, function (data) {
                   console.log("deleted node "); 
              
                restTableData();          
          });
    }
    
    
        
    var stubForm='<div id="form">'+
        '<table><tr><td><label class="form-control-label" for="serverName">Server Name  </label></td>'+
        '<td><input type="text" id="serverName" placeholder="Server Name"></td></tr>'+
        '<tr><td><label class="form-control-label" for="serverIp">Server Ip </label></td>'+
        '<td><input type="text" id="serverIp" placeholder="Server IP"></td></tr></table>';
    
    makeModel(stubForm, "addServer", "Add New Server");
</script>