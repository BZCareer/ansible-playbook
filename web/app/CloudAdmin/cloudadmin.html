<div class="panel panel-default">
<div class="panel-heading"><h4 class="bulletinBoard">Server Administration Page </h4> </div>
<table id="data" class="table table-striped table-bordered" cellspacing="0" width="100%">
    <thead>
        <tr>
            <th>Server Name</th>
            <th>Server IP </th>
            <th>Menu</th>
        </tr>
    </thead>
    <tbody id="tableContent">
    </tbody>
</table>
<div class="panel-footer">
    <a href="javascript: void(0)" class="btn btn-primary" data-toggle="modal" data-target="#addServer">Add New Server</a>

    </div>
    
</div>



<script type="application/javascript">
    var getJSON = function (apiurl, action, payload, callback) {
        $.ajax({
            type: action
            , url: apiurl
            , data: payload
            , contentType: "application/json"
            , dataType: "json"
            , cache: false
            , success: callback
        });
    }

    

    var growl = function (gtitle, gtext) {
        new PNotify({
            title: gtitle
            , text: gtext
        });
    };


    var appendTableData = function (serverName, serverIp, id) {
        var line = "<tr><td>" + serverName + "</td><td>" + serverIp + "</td>" +
            '<td>  <a href="javascript: void(0)" class="btn btn-primary">Ansible Provision</a>' +
            '<a href="javascript: void(0)" class="btn btn-primary"> Code Deploy</a>' +
            '<a href="javascript: void(0)" onclick="deleteNode('+"'" + id +"'"+')" class="btn btn-danger">'+
            '<i class="fa fa-trash" aria-hidden="true"></i>Delete</a></td></tr>';
        $("#tableContent").append(line);
    }

    function restTableData() {
        $("#tableContent").empty();
         getJSON("/api/nodes", "GET", null, function (data) {
        for (var i = 0; i < data.length; i++) {
            appendTableData(data[i].serverIp, data[i].serverName, data[i].id);
        }
    });

    }
    
    getJSON("/api/nodes", "GET", null, function (data) {
        for (var i = 0; i < data.length; i++) {
            appendTableData(data[i].serverIp, data[i].serverName, data[i].id);
        }
    });
    var makeModel = (function (formFields, id, title) {
        html = '<!-- Modal -->' +
            '<div class="modal fade" id="' + id + '" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">' +
            '<div class="modal-dialog">' +
            '<div class="modal-content">' +
            '<div class="modal-header">' +
            '<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>' +
            '<h4 class="modal-title" id="myModalLabel">' + title + '</h4>' +
            '</div>' +
            '<div class="modal-body">' +
            formFields +
            '</div>' +
            '<div class="modal-footer">' + //	buttons+
            '<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>' +
            '<button type="button" onclick="createNewNode()" class="btn btn-primary">Save</button>' +
            '</div>' +
            '</div>' +
            '</div>' +
            '</div>';
        $("body").append(html);
    });
    
    var createNewNode= function(){
        console.log("adding new server!!");
        var req = { 
         "serverName":  $("#serverName").val().toString(),
         "serverIp": $("#serverIp").val().toString()
       }
       getJSON("/api/nodes", 
               "POST", 
               JSON.stringify(req), 
               function (data) {
               restTableData(); 
               $("#addServer").modal('hide');
           growl("New Server Added "," Server Name: " + $("#serverName").val().toString()+" Server Ip: "+$("#serverIp").val().toString() )
       });
    }
    var deleteNode=function( id ){
          getJSON("/api/nodes/"+id, "DELETE", null, function (data) {
                   console.log("deleted node "); 
                restTableData();          
          });
    }
     

    var createModalFormHTML= function(obj){
        
             var stub='<div id="serverform">';
        
obj.getFields.forEach(function(o){        
 stub+='<div class="input-group">'+
  '<span class="input-group-addon" id="basic-addon1">'+
  '  <label class="form-control-label" style="width: 80px;"  for="'+ o.getFieldId +'">'+ o.getFieldName +'</label></span>'+
  '<input type="text" id="'+ o.getFieldId +'" class="form-control" placeholder="'+ o.getFieldName +'" aria-describedby="basic-addon1">'+
'</div><br>';
    },this);
        
        stub += '</div>';
        
        return stub;
    }
    
    var stubForm='<div id="serverform">'+
 '<div class="input-group">'+
  '<span class="input-group-addon" id="basic-addon1">'+
  '  <label class="form-control-label" style="width: 80px;"  for="serverName"> Server Name </label></span>'+
  '<input type="text" id="serverName" class="form-control" placeholder="Server Name" aria-describedby="basic-addon1">'+
'</div><br><div class="input-group">'+
  '<span class="input-group-addon" id="basic-addon1">'+
  '<label class="form-control-label" style="width: 80px;"  for="serverIp">Server Ip </label></span>'+
  '<input type="text" class="form-control" id="serverIp" placeholder="Server IP" aria-describedby="basic-addon1">'+
'</div></div>';
    makeModel(stubForm, "addServer", "Add New Server");
</script>