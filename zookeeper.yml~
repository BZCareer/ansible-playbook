---
# Author: Zak Hassan
# Usage: ansible-playbook zookeeper.yml
# 
# Description: Playbook created to demonstrate provisioning cloud environment in like less than 1 min. :) 
#
 - name: Configure Apache Zookeeper
   hosts:  openstackcloud-server1
   sudo: True     
   gather_facts: True
   vars:
     service_name: zookeeper
     zk_dir: /usr/local/zookeeper
     clientPort : 2181
     dataDir: /usr/local/zookeeper/logs/
     syncLimit: 2
     initLimit: 5
     tickTime: 2000
     myid: 1
   tasks:
     - name: install git
       yum: name=git state=latest
     - name: install java7
       yum: name=java-1.7.0-openjdk-devel.x86_64 state=latest
     - name: install wget
       yum: name=wget state=latest
     - name: download zookeeper from apache mirror
       script: wget http://apache.sunsite.ualberta.ca/zookeeper/zookeeper-3.5.1-alpha/zookeeper-3.5.1-alpha.tar.gz -P /tmp/
     - name: unzip tarball and place in /usr/local/ 
       script: tar zxf /tmp/zookeeper-3.5.1-alpha.tar.gz -C /usr/local/
     - name: rename file
       script: mv /usr/local/zkdir/zookeeper-3.5.1-alpha/  /usr/local/zkdir/zookeeper
     - name: setup configuration file
       template: src=templates/zoo.cfg.j2
             dest=/usr/local/zookeeper/conf/zoo.cfg
     - name: setup zk myid file
       template: src=templates/myid.j2
             dest=/usr/local/zookeeper/logs/myid
     - name: change permissions to centos user
       command: chown -R centos:centos /usr/local/zookeeper
     - name: setup systemd unit file
       template: src=templates/zookeeper-systemd.j2
             dest=/lib/systemd/system/zookeeper.service
       register: install_config
#     - name: creating zookeeper directory structure
#       git: repo=https://github.com/zmhassan/zookeeper-quickstart.git dest=/usr/local/zookeeper update=yes
#     - name: notify systemd of config changes
#       command: systemctl daemon-reload
#       when: install_config.changed == True
#     - name: start zookeeper and set to start on startup
#       service: name=zookeeper state=started enabled=yes
